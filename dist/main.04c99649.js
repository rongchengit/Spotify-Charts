"use strict";(self.webpackChunkspotifychart=self.webpackChunkspotifychart||[]).push([[179],{27576:(t,e,a)=>{a(28594),a(35666);var o=a(67294),n=a(20745),i=a(5267),r=a(89250);function c(t){let e="";for(let a=0;a<t;a++)e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(Math.floor(62*Math.random()));return e}function l(){return JSON.parse(localStorage.getItem("tokenSet"))}function s(){localStorage.removeItem("tokenSet"),localStorage.removeItem("code"),localStorage.removeItem("code-verifier")}async function p(){const t=await fetch("https://accounts.spotify.com/api/token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({grant_type:"refresh_token",refresh_token:JSON.parse(localStorage.getItem("tokenSet")).refresh_token,client_id:"98d7d7247b8e4cb3a1c7f6257ee1fa61"})});if(!t.ok)throw new Error("could not get access token via refresh token");const e=await t.json(),a=Date.now()+1e3*e.expires_in;localStorage.setItem("tokenSet",JSON.stringify({...e,expires_at:a}))}async function u(){const t=await fetch("https://accounts.spotify.com/api/token",{method:"POST",body:"grant_type=client_credentials",headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json",Authorization:"Basic OThkN2Q3MjQ3YjhlNGNiM2ExYzdmNjI1N2VlMWZhNjE6YWI5NmY2ZjhmYjkxNDFlZGFlMzc0MDg2NDU5ZTMwNDc="}}),e=await t.json();localStorage.setItem("tokenSet",JSON.stringify({access_token:e.access_token,expires_at:Date.now()+36e5}))}async function d(){const t=l();if(!t||!t.refresh_token&&localStorage.getItem("code-verifier")){if(!localStorage.getItem("code")?.length&&window.location.search.length&&localStorage.setItem("code",new URLSearchParams(window.location.search).get("code")),!localStorage.getItem("code-verifier")||!localStorage.getItem("code")?.length)return await u(),l().access_token;await async function(){const t=localStorage.getItem("code-verifier"),e=localStorage.getItem("code");await async function(t){const e=await fetch("https://accounts.spotify.com/api/token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({client_id:"98d7d7247b8e4cb3a1c7f6257ee1fa61",...t})});if(!e.ok)throw new Error("could not get access token");const a=await e.json(),o=a.access_token,n=Date.now()+1e3*a.expires_in;return localStorage.setItem("tokenSet",JSON.stringify({...a,expires_at:n})),o}({grant_type:"authorization_code",code:e,redirect_uri:"http://localhost:3000/callback",code_verifier:t})}()}else if(t.refresh_token&&t.expires_at<Date.now()+6e4)await p();else if(!t.refresh_token&&t.expires_at<Date.now()+6e4)return s(),await u(),l().access_token;return l().access_token}function h(){const t=l();return t&&t.refresh_token}var f=a(97296);function m(t,e,a,o,n){return e===a?(o+n)/2:o+(t-e)/(a-e)*(n-o)}function g(t,e,a){const o=t.reduce(((t,e)=>t+e.count),0);let n=t.reduce(((t,e)=>t>("popularity"===a?e.popularity:e.count)?t:"popularity"===a?e.popularity:e.count),1);"popularity"===a&&(n/=.3);const i=t.reduce(((t,e)=>t<("popularity"===a?e.popularity:e.count)?t:"popularity"===a?e.popularity:e.count),n);f.Ys("#bubbleChart").select("svg").remove();const r=f.Ys("#bubbleChart").append("svg").attr("width",window.innerWidth<600?500:"1000").attr("height",window.innerWidth<600?600:"1000");r.append("defs").selectAll("pattern").data(t).enter().append("pattern").attr("id",((t,e)=>e)).attr("x",0).attr("y",0).attr("height",1).attr("width",1).attr("patternUnits","objectBoundingBox").append("image").attr("x",0).attr("y",0).attr("height",(t=>2*m("popularity"===a?t.popularity:t.count,i,n,window.innerWidth<600?15:25,window.innerWidth<600?60:100))).attr("width",(t=>2*m("popularity"===a?t.popularity:t.count,i,n,window.innerWidth<600?15:25,window.innerWidth<600?60:100))).attr("preserveAspectRatio","none").attr("xlink:href",(t=>t.image));const c=r.append("g").selectAll("circle").data(t).enter().append("circle").attr("r",(t=>m("popularity"===a?t.popularity:t.count,i,n,window.innerWidth<600?15:25,window.innerWidth<600?60:100))).attr("cx",r.node().clientWidth/2).attr("cy",r.node().clientHeight/2).style("fill",((t,e)=>`url(#${e})`)).attr("stroke","#1DB954").style("stroke-width",4).on("click",(function(t,e){l.style("opacity",1).html("artist: "+e.name+"<br />count: "+e.count+"<br />percentage: "+(100*e.count/o).toFixed(2)+"%<br />genres: "+e.genres?.join(", ")+"<br />popularity: "+e.popularity).style("left",t.pageX+"px").style("top",t.pageY+"px")})).on("mouseleave",(function(t,e){l.transition().duration(500).style("opacity",0)})).call(f.ohM().on("start",(function(t,e){t.active||s.alphaTarget(.03).restart(),e.fx=e.x,e.fy=e.y})).on("drag",(function(t,e){e.fx=t.x,e.fy=t.y})).on("end",(function(t,e){t.active||s.alphaTarget(.03),e.fx=null,e.fy=null}))),l=f.Ys("#bubbleChart").append("div").style("opacity",0).style("position","absolute").attr("class","tooltip").style("background-color","black").style("border-radius","5px").style("padding","10px").style("color","#1DB954");r.insert("image",":first-child").attr("href",e).attr("width",r.node().clientWidth).attr("height",r.node().clientHeight).attr("preserveAspectRatio","xMidYMid slice").style("opacity",.5);const s=f.A4v().force("center",f.wqt().x(r.node().clientWidth/2).y(r.node().clientHeight/2)).force("charge",f.q5i().strength(1)).force("collide",f.Hh().strength(.5).radius((t=>m("popularity"===a?t.popularity:t.count,i,n,window.innerWidth<600?15:25,window.innerWidth<600?60:100))).iterations(1)).force("attract",f.DXo(0,r.node().clientWidth/2,r.node().clientHeight/2).strength(.05));s.nodes(t).on("tick",(function(t){c.attr("cx",(t=>t.x)).attr("cy",(t=>t.y))}))}class y extends o.Component{constructor(t){super(t),this.state={data:[]}}componentDidMount(){if(this.props.playlistID){const t=[];(async function(t){if("likedSongs"===t)return async function(){const t="https://api.spotify.com/v1/me/tracks",e=await d(),a=await fetch(t+"?limit=50",{headers:{Authorization:"Bearer "+e,"Content-Type":"application/json",Accept:"application/json"}}),o=await a.json();let n=o.items;if(o.total>o.limit){const a=Math.ceil((o.total-o.limit)/o.limit),i=[];for(let e=1;e<=a;e++)i.push(t+"?limit=50&offset="+e*o.limit);(await Promise.all(i.map((async t=>(await fetch(t,{headers:{Authorization:"Bearer "+e,"Content-Type":"application/json",Accept:"application/json"}})).json())))).forEach((t=>{n=n.concat(t.items)}))}return n}();const e=`https://api.spotify.com/v1/playlists/${t}/tracks`,a=await d(),o=await fetch(e,{headers:{Authorization:"Bearer "+a,"Content-Type":"application/json",Accept:"application/json"}}),n=await o.json();let i=n.items;if(n.total>n.limit){const t=Math.ceil((n.total-n.limit)/n.limit),o=[];for(let a=1;a<=t;a++)o.push(e+"?offset="+a*n.limit);(await Promise.all(o.map((async t=>(await fetch(t,{headers:{Authorization:"Bearer "+a,"Content-Type":"application/json",Accept:"application/json"}})).json())))).forEach((t=>{i=i.concat(t.items)}))}return i})(this.props.playlistID).then((e=>{const a=e.map((t=>({id:t.track.id,genres:[],artistNames:t.track.artists.map((t=>t.name)),artistIds:t.track.artists.map((t=>t.id)),artistPopularity:-1}))),o=a.flatMap((t=>t.artistIds)),n=o.filter(((t,e)=>t&&o.indexOf(t)===e));n.length&&async function(t){const e=function(t,e){const a=[],o=t.length;let n=0;for(;n<o;)a.push(t.slice(n,n+50)),n+=50;return a}(t);let a=[];for(let t=0;t<e.length;t++)a.push(`https://api.spotify.com/v1/artists?ids=${e[t].join()}`);const o=await d(),n=await Promise.all(a.map((t=>fetch(t,{headers:{Authorization:"Bearer "+o,"Content-Type":"application/json",Accept:"application/json"}}))));let i=[];for(let t of n){const e=await t.json();i.push(...e.artists)}return i}(n).then((e=>{e.forEach((t=>{a.filter((e=>e.artistIds.includes(t.id))).forEach((e=>{e.genres.push(...t.genres),e.artistPopularity=t.popularity}))})),a.forEach((a=>{a.artistNames.forEach((o=>{const n=t.find((t=>t.name===o));if(n)n.count++;else{const n=e.find((t=>t.name===o))?.images;let i="https://media.istockphoto.com/id/1344687455/vector/question-sing-flat-icon-vector-illustration-isolated-on-white-background.jpg?s=612x612&w=0&k=20&c=ZU6kq0hQacI7mZoYuXTqXF8KsgNnbCRaxDm_nAIdCAw=";n?.length&&(i=n[0].url),t.push({name:o,count:1,image:i,genres:a.genres,popularity:a.artistPopularity})}}))})),this.setState({data:t.sort(((t,e)=>t.count>e.count?-1:1)).slice(0,100)}),g(t.sort(((t,e)=>t.count>e.count?-1:1)).slice(0,100),this.props.imageURL,"count")}))}))}}render(){return o.createElement("div",null,o.createElement("div",{className:"center",id:"bubbleChart"}),o.createElement("div",null,o.createElement("button",{onClick:()=>g(this.state.data,this.props.imageURL,"count")},"By Count"),o.createElement("button",{onClick:()=>g(this.state.data,this.props.imageURL,"popularity")},"By Popularity")))}}var w=a(10657);const k={control:t=>({...t,color:"#5A5A5A",backgroundColor:"#1DB954",borderColor:"#5A5A5A",borderRadius:"25px",fontFamily:"Gotham Rounded, sans-serif",fontSize:"24px",width:"500px",display:"flex",justifyContent:"center",margin:"0 auto",textAlign:"center"}),option:(t,e)=>({...t,backgroundColor:e.isSelected||e.isFocused||e.isActive?"#1DB954":"#191414",color:"#5A5A5A",fontFamily:"Gotham Rounded, sans-serif",fontSize:"24px"}),menu:t=>({...t,backgroundColor:"#191414",overflow:"hidden",position:"relative",width:"500px",margin:"0 auto",textAlign:"center"}),menuList:t=>({...t,"&::-webkit-scrollbar":{width:"10px"},"&::-webkit-scrollbar-track":{background:"#f1f1f1",borderRadius:"10px"},"&::-webkit-scrollbar-thumb":{background:"#888",borderRadius:"10px"},"&::-webkit-scrollbar-thumb:hover":{background:"#555"}}),singleValue:t=>({...t,color:"#5A5A5A"}),placeholder:t=>({...t,color:"#5A5A5A"})},b=function(){const[t,e]=(0,o.useState)([]),[a,n]=(0,o.useState)(""),[i,r]=(0,o.useState)(),[u,f]=(0,o.useState)(""),m=t=>{(async function(t){const e=`https://api.spotify.com/v1/users/${t}/playlists`,a=await fetch(e,{headers:{Authorization:"Bearer "+await d(),"Content-Type":"application/json",Accept:"application/json"}}),o=await a.json(),n=o.items;return h()&&n.push({id:"likedSongs",name:"Liked Songs",images:[]}),o.items})(t).then((t=>{const a=t.map((t=>({value:t.id,label:t.name,albumImg:t.images[0]?.url??"http://localhost:8080/squid.png"})));e(a),r(a[0]);const o=a.findIndex((t=>"likedSongs"===t.value));-1!==o&&r(a[o])})).catch((t=>console.error(t)))};return(0,o.useEffect)((()=>{(async function(){if(h()){const t=await fetch("https://api.spotify.com/v1/me",{headers:{Authorization:"Bearer "+await d()}}),e=await t.json();return function(t){const e=l();e.user_id=t,localStorage.setItem("tokenSet",JSON.stringify(e))}(e.id),e}})().then((t=>{t?.id&&(f(t.id),n(t.id),m(t.id))}))}),[]),o.createElement("div",null,u?o.createElement(o.Fragment,null,o.createElement("button",{onClick:()=>{s(),e([]),n(""),r(void 0),f("")}},"logout")," ",o.createElement("p",null,u)):o.createElement("button",{onClick:async()=>{await async function(){if(localStorage.getItem("code")&&localStorage.getItem("code-verifier")){const t=l();return void(t?.refresh_token&&t.expires_at<Date.now()+6e4&&await p())}let t=c(128);(async function(t){const e=(new TextEncoder).encode(t);return a=await window.crypto.subtle.digest("SHA-256",e),btoa(String.fromCharCode.apply(null,new Uint8Array(a))).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"");var a})(t).then((e=>{let a=c(16),o=new URLSearchParams({response_type:"code",client_id:"98d7d7247b8e4cb3a1c7f6257ee1fa61",scope:"playlist-read-private user-library-read user-follow-read",redirect_uri:"http://localhost:3000/callback",state:a,code_challenge_method:"S256",code_challenge:e});localStorage.setItem("code-verifier",t),window.location.href="https://accounts.spotify.com/authorize?"+o}))}()}},"login"),o.createElement("form",{className:"center",onSubmit:t=>{t.preventDefault(),m(a)}},o.createElement("input",{value:a,className:"defaultInput",type:"text",name:"userID",placeholder:"Username",onChange:t=>{n(t.target.value)}})),o.createElement("div",null,o.createElement(w.ZP,{styles:k,options:t,value:i,onChange:(t,e)=>{t&&r(t)},placeholder:"Spotify Playlist"})),i&&o.createElement(y,{key:i.value,playlistID:i.value,imageURL:i.albumImg}))},v=()=>{const t=(0,r.s0)();return(0,o.useEffect)((()=>{d().then((()=>{t("/")}))}),[t]),o.createElement("div",null)},S=function(){return(0,o.useEffect)((()=>{}),[]),o.createElement(r.Z5,null,o.createElement(r.AW,{path:"/",element:o.createElement(b,null)}),o.createElement(r.AW,{path:"/callback",element:o.createElement(v,null)}))};var x=a(79655);const _=window.__CONFIG__;delete window.__CONFIG__,(0,n.a)(document.getElementById("root"),o.createElement(o.Fragment,null,o.createElement(i.Z.Provider,{value:_},o.createElement(x.VK,null,o.createElement(S,null)))))}},t=>{t.O(0,[736,160],(()=>(27576,t(t.s=27576)))),t.O()}]);
//# sourceMappingURL=main.04c99649.js.map